    [h:id = arg(0)]

    [dialog5("Feature", "width=400; height=800; temporary=1; input=1; noframe=0"), code: {
    <head>
    [r:style()]
    [r:script()]
    [r:'
    <style>
        .checkbox-container {
        display: flex;
        align-items: center;       /* Vertically center the items */
        justify-content: center;    /* Horizontally center the items */
        width: 100%;
        margin: 5px;
        }

        .checkbox-grid {
            display: grid; /* Enable grid layout */
            grid-template-columns: repeat(3, 1fr); /* Create 3 equal columns */
            gap: 0px; /* Add space between items */
            width: 100%;
            margin: 10px 0px;
        }

        .checkbox-text {
        font-size: 90%;
        min-width: 40px;
        padding-bottom: 3px;
        margin-right: 8px;
        }

        .checkbox {
        width: 20px;
        height: 20px;
        border: 2px solid #333;
        border-radius: 4px;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: background-color 0.3s ease;
        user-select: none;
        }

        .checkbox[data-checked="true"] {
        background-color: #4caf50;
        color: white;
        }

        .checkbox[data-checked="true"]::after {
        font-size: 14px;
        font-weight: bold;
        }
    </style>
    <script>

        //=====================================================================================================
        // Execution
        //=====================================================================================================

        function onWindowLoad() {
            loadPage()

            getId("cancel").addEventListener("click", () => {
                closePage("Feature")
            })

            updateFields()
            addSubmitBehavior()

            updateCheckboxes()
        }

        function loadPage() {
            getId("content").innerHTML += 

                container("Basic",
                    input("name", "Name") +

                    select("level", "Level", [
                        "1st", "2nd", "3rd", "4th", "5th", "6th", "7th", "8th", "9th"]) +

                    select("school", "School of Magic", [
                        "abjuration","conjuration","divination","enchantment",
                        "evocation","illusion","necromancy","transmutation"])
                ) +
                
                container("Classes",
                    checkbox_grid([
                        ["bard", "Bard"], ["druid", "Druid"], ["cleric", "Cleric"],
                        ["sorcerer", "Sorcerer"], ["warlock", "Warlock"], ["wizard", "Wizard"],
                    ])
                ) +

                container("Casting",
                    select("cast_time", "Cast Time", [
                        "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"]) +

                    select("range", "Range Type", [
                        "self", "touch", "sight", "unlimited", "special", "distance"]) +

                    input("range-distance", "Range in Feet") +

                    input("target", "Target") +

                    input("duration", "Duration in Rounds")
                ) +

                container("Components",
                    checkbox_grid([
                        ["vocal", "Vocal"], ["somatic", "Somatic"], 
                        ["material", "Material"], ["concentration", "Concentration"]
                    ], "2", "80")
                ) +

                container("Information",
                    text_area("description", "Description", "10") +

                    text_area("description-higher-levels", "Description for Upcasting", "5")
                )
        }



        //=====================================================================================================
        // Helper functions
        //=====================================================================================================

        function updateFields() {
            id = getId("id").value

            if(id == "") {return}

            toBackend("database.features.data", (response) => {
                response = JSON.parse(response)
                
                getId("name").value = capitalize(response[id].name)

            })
        }

        function addSubmitBehavior() {
            getId("submit").addEventListener("click", async () => {
                


                // Get values from form
                let name = getId("name").value;


                // Treatment
                

                // Send data to backend
                toBackend(
                    "database.set_spell("+
                        "`"+name+"`,"+
                        "`"+level+"`,"+
                        "`"+school+"`,"+
                        "`"+classes+"`,"+
                        "`"+cast_time+"`,"+
                        "`"+range+"`,"+
                        "`"+target+"`,"+
                        "`"+components+"`,"+
                        "`"+duration+"`,"+
                        "`"+description+"`,"+
                        "`"+description_higher_levels+"`,"+
                    ")"
                )

                closePage("Feature")

            })
        }

        function updateCheckboxes() {
            // Select all elements with the class checkbox
            const checkboxes = document.querySelectorAll(".checkbox");

            checkboxes.forEach(checkbox => {
            checkbox.addEventListener("click", () => {
                // Toggle the data-checked attribute
                const isChecked = checkbox.getAttribute("data-checked") === "true";
                checkbox.setAttribute("data-checked", !isChecked);
            });
            });
        }



        //=====================================================================================================
        // Components
        //=====================================================================================================

        function title(title = "") {
            return `
            <h4>`+title+`</h4>
            `
        }

        function input(id = "", title = "", placeholder = "") {
            return `
            <h4>`+title+`</h4>
            <input id="`+id+`" placeholder="`+placeholder+`"></input>
            `
        }

        function select(id = "", title = "", options = []) {
            options_string = ""
            for (const value of options) {
                options_string += `<option value=`+value+`>`+capitalize(value)+`</option>`
            }
            return `
            <h4>`+title+`</h4>
            <select id="`+id+`">
                <option value="" hidden>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                </option>
                `+options_string+`
            </select>
            `
        }

        function checkbox(id = "", title = "", min_width = "40") {
            if (id == "" && title == "") {
                style = `style="display:none"`
            } else {style = ""}

            return `
            <div class="checkbox-container">
                <span class="checkbox-text" style="min-width: `+min_width+`px;">`+title+`</span>
                <div class="checkbox" `+style+` data-checked="`+"false"+`"></div>
            </div>
            `
        }

        function checkbox_grid(checkboxes = [["","Title"]], rows="3", min_width="40") {
            let checkboxes_string = ""
            for (const box of checkboxes) {
                console.log(box)
                checkboxes_string += checkbox(box[0], box[1], min_width)
            }

            return `
            <div class="checkbox-grid" style = "grid-template-columns: repeat(`+rows+`, 1fr)">
                `+checkboxes_string+`
            </div>
            `
        }

        function text_area(id = "", title = "", size = "7") {
            return `
            <h4>`+title+`</h4>
            <textarea id="`+id+`" rows="`+size+`" cols="30"></textarea>
            `
        }

        function container(title="", children="") {

            return `
            <div class="spacer"></div>
            <div class="container center-horizontal" style="padding-bottom:0px;">
                <h3 class="container-title">`+title+`</h3>
                <div class="spacer" ></div>
                `+children+`
                <div class="spacer"></div>
            </div>
            <div class="spacer"></div>
            `
        }


        //=====================================================================================================

        document.addEventListener("DOMContentLoaded", onWindowLoad)

    </script>
    ']
    </head>

    <input type="text" class="hidden" id="id" value="{id}"></input>

    <body>
        <div class="outer">

            <div id="content"></div>

            <button id="cancel">Cancel</button>
            <button id="submit">Accept</button>

        </div>
    </body>

    }]