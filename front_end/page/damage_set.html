[h:id = arg(0)]
[h:image = getTokenImage("",getSelected())]

[dialog5("Damage Type", "width=400; height=800; temporary=1; input=1; noframe=0"), code: {
<head>
[r:style()]
[r:script()]
[r:'
<style>
</style>
<script>

    //=====================================================================================================
    // Execution
    //=====================================================================================================

    function onWindowLoad() {

        getId("cancel").addEventListener("click", () => {
            closePage("Damage Type")
        })

        updateFields()
        addSubmitBehavior()
    }



    //=====================================================================================================
    // Helper functions
    //=====================================================================================================

    function updateFields() {
        id = getId("id").value

        if(id == "") {return}

        toBackend("database.damage_types.data", (response) => {
            response = JSON.parse(response)
            
            getId("name").value = capitalize(response[id].name)
            getId("type").value = capitalize(response[id].type)
            getId("description").value = response[id].description

            if(response[id].image) {
                getId("image").value = response[id].image
            }
        })
    }


    function addSubmitBehavior() {
        getId("submit").addEventListener("click", async () => {


            // Get values from form
            let name = getId("name").value;
            let type = getId("type").value;
            let description = getId("description").value;
            let image = getId("image").value;


            // Treatment
            name = name.toLowerCase()
            type = type.toLowerCase()


            // Send data to backend
            toBackend(
                "database.set_damage_type("+
                    "`"+name+"`,"+
                    "`"+type+"`,"+
                    "`"+description+"`,"+
                    "`"+image+"`,"+
                ")"
            )

            closePage("Damage Type")

        })
    }



    //=====================================================================================================

    document.addEventListener("DOMContentLoaded", onWindowLoad)

</script>
']
</head>

<input type="text" class="hidden" id="id" value="{id}"></input>

<body>
    <div class="outer">

        <div class="spacer"></div>

        <div class="container center-horizontal" style="padding-bottom:0px;">
            <h3 class="container-title">Information</h3>

            <div class="spacer" ></div>

            <h4>Name</h4>
            <input id="name" placeholder></input>

            <h4>Type</h4>
            <select id="type">
                <option value="" hidden>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                </option>
                <option>Physical</option>
                <option>Elemental</option>
                <option>Special</option>
            </select>

            <h4>Description</h4>
            <textarea id="description" rows="15" cols="30"></textarea>

            <h4>Image</h4>
            <input id="image" value="{image}"></input>

        </div>

        <button id="cancel">Cancel</button>
        <button id="submit">Accept</button>

    </div>
</body>

}]