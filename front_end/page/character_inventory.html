[h,if(!argCount()>0):id = arg(0); id = getImpersonated()]
[h,if(id==""):id = getImpersonated()]

[dialog5("Inventory", "width=400; height=800; temporary=1; input=1; noframe=0"), code: {
<head>
    <script>
        const id = "{id}"
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="style.css@lib:front"></link>
    [r:scriptTag("open")][r:importScript("script.js@lib:front")][r:scriptTag("close")]
    [r:scriptTag("open")][r:importScript("components.js@lib:front")][r:scriptTag("close")]

    [r:'
    <style>

    .inventory-item {
        background-color:#222;
        border: 0.2vh solid #555;
        border-radius: 0.5vh;

        height: 5.5vh;
        width: 5.5vh;

        transition: background-color 0.2s ease;
    }

    .inventory-item:hover {
        background-color:#333
    }

    </style>
    <script>

    //=====================================================================================================
    // Helper functions
    //=====================================================================================================

    let draggedElement = null;
    let initialPosition = null;

    function dragStart(event) {
        draggedElement = event.target;
        initialPosition = draggedElement.dataset.position;
    }

    function dragEnd(event) {
        draggedElement.style.visibility = "visible";
    }

    function dragOver(event) {
        event.preventDefault();
    }

    function drop(event) {
        event.preventDefault();
        const target = event.target.closest(".grid-item");

        if (target) {
            const finalPosition = target.dataset.position;
            console.log("Initial position: "+initialPosition+", Dropped on position: "+finalPosition);
            // Reset draggedElement visibility without moving it
            draggedElement.style.visibility = "visible";
        }
    }

    function updateInventory() {
        
        toBackend(" [impersonated().inventory , database.items.data] ", (response) => {
            response = JSON.parse(response)
            
            const inventory = response[0]
            const item_database = response[1]

            console.log(inventory)

            let grid_content = ""
            for (let i=0; i<18; i++) {

                // Add item information

                const slot = inventory[i]
                const item = item_database[slot.name] || null

                if (item != null) {
                    content = img({
                        src:item.image,
                        style:"position:relative; height:80%; top:10%"
                    })
                } else {
                    content = ""
                }

                // Add grid slot information

                const grid_slot = getId("inventory-"+i+"-slot")

                grid_slot.dataset.position = i
                grid_slot.addEventListener("dragover", dragOver);
                grid_slot.addEventListener("drop", drop);
                grid_slot.innerHTML = content


                // Add item behavior

                const grid_item = grid_slot.children[0] || null

                if(grid_item) {
                    grid_item.draggable = true
                    grid_item.dataset.position = i
                    grid_item.addEventListener("dragstart", dragStart);
                    grid_item.addEventListener("dragend", dragEnd);
                }
            }
        })
    }

    //=====================================================================================================
    // Execution
    //=====================================================================================================

    function loadPage() {

        grid_content = ""
        for (let i=0; i<18; i++) {
            grid_content += (
                div({classes:"inventory-item", id:"inventory-"+i+"-slot"})
            )
        }
        
        document.body.innerHTML = (
            context_menu({content:["equip", "send", "drop"], id:"teste-context-menu"}) +
            div({classes:"outer", style:"overflow:hidden;", id:"content"})
        )

        getId("content").innerHTML += (
            container({title:"Inventory", content:(
                div({style: "margin-auto",content:(
                    grid({
                        id:"inventory",
                        classes: "center-horizontal",
                        style: "position:relative; width:39vh; text-align:center; place-items:center; margin-top:2vh;",
                        columns: 6,
                        gap:"0.5vh", 
                        content:grid_content
                    })
                )})
            )})
        )
    }

    function onWindowLoad() {

        // Body HTML
        loadPage()

        updateInventory()
    }



    //=====================================================================================================

    document.addEventListener("DOMContentLoaded", onWindowLoad)

    </script>
    ']
</head>

<body>
</body>

}]