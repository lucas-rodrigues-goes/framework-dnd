[h:id = arg(0)]

[dialog5("Proficiency", "width=400; height=900; temporary=0; input=1; noframe=0"), code: {
<head>

    <link rel="stylesheet" type="text/css" href="style.css@lib:front"></link>
    [r:scriptTag("open")][r:importScript("script.js@lib:front")][r:scriptTag("close")]
        
    [r:'
    <style>
        .checkbox-container {
        display: flex;
        align-items: center;       /* Vertically center the items */
        justify-content: center;    /* Horizontally center the items */
        width: 100%;
        margin: 5px;
        }

        .checkbox-grid {
            display: grid; /* Enable grid layout */
            grid-template-columns: repeat(3, 1fr); /* Create 3 equal columns */
            gap: 0px; /* Add space between items */
            width: 100%;
            margin: 10px 0px;
        }

        .checkbox-text {
        font-size: 90%;
        min-width: 40px;
        padding-bottom: 3px;
        margin-right: 8px;
        }

        .checkbox {
        width: 20px;
        height: 20px;
        border: 2px solid #333;
        border-radius: 4px;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        user-select: none;
        }

        .checkbox[data-checked="true"] {
        background-color: #ddd;
        color: white;
        }

        .checkbox[data-checked="true"]::after {
        font-size: 14px;
        font-weight: bold;
        }
    </style>
    <script>

        //=====================================================================================================
        // Components
        //=====================================================================================================

        function title(title = "") {
            return `
            <h4>`+title+`</h4>
            `
        }

        function input(id = "", title = "", placeholder = "", style = "") {
            return `
            <h4 id="`+id+`-title">`+title+`</h4>
            <input style="`+style+`" id="`+id+`" placeholder="`+placeholder+`"></input>
            `
        }

        function select(id = "", title = "", options = [], placeholder="", style = "") {
            options_string = ""
            for (const value of options) {
                options_string += `<option value=`+value+`>`+capitalize(value)+`</option>`
            }
            return `
            <h4 id="`+id+`-title">`+title+`</h4>
            <select required style="`+style+`" id="`+id+`">
                <option disabled selected value="" hidden>`+placeholder+`</option>
                `+options_string+`
            </select>
            `
        }

        function inline_select(id = "", options = [], placeholder="", style = "") {
            options_string = ""
            for (const value of options) {
                options_string += `<option value=`+value+`>`+capitalize(value)+`</option>`
            }
            return `
            <select required style="`+style+`" id="`+id+`">
                <option value="" disabled selected hidden>`+placeholder+`</option>
                `+options_string+`
            </select>
            `
        }

        function checkbox(id = "", title = "", min_width = "40") {
            if (id == "" && title == "") {
                style = `style="display:none"`
            } else {style = ""}

            return `
            <div class="checkbox-container">
                <span class="checkbox-text" style="min-width: `+min_width+`px;">`+title+`</span>
                <div class="checkbox" id="`+id+`" `+style+` data-checked="`+"false"+`"></div>
            </div>
            `
        }

        function checkbox_grid(checkboxes = [["","Title"]], rows="3", min_width="40") {
            let checkboxes_string = ""
            for (const box of checkboxes) {
                checkboxes_string += checkbox(box[0], box[1], min_width)
            }

            return `
            <div class="checkbox-grid" style = "grid-template-columns: repeat(`+rows+`, 1fr)">
                `+checkboxes_string+`
            </div>
            `
        }

        function text_area(id = "", title = "", size = "7") {
            return `
            <h4>`+title+`</h4>
            <textarea id="`+id+`" rows="`+size+`" cols="30"></textarea>
            `
        }

        function container(title="", children="") {

            return `
            <div class="spacer"></div>
            <div class="container center-horizontal" style="padding-bottom:0px;">
                <h3 class="container-title">`+title+`</h3>
                <div class="spacer" ></div>
                `+children+`
                <div class="spacer"></div>
            </div>
            <div class="spacer"></div>
            `
        }



        //=====================================================================================================
        // Helper functions
        //=====================================================================================================

        function updateFields() {
            id = getId("id").value

            if(id == "") {return}

            toBackend(`database.get_proficiency("`+id+`")`, (response) => {
                proficiency = JSON.parse(response)
                
                getId("name").value = capitalize(proficiency.name)
                getId("type").value = proficiency.type

                getId("description-proficient").value = proficiency.description[0]
                getId("description-expert").value = proficiency.description[1]
                getId("description-master").value = proficiency.description[2]
                getId("description-grandmaster").value = proficiency.description[3]
            })
        }

        function loadCheckboxes() {
            // Select all elements with the class checkbox
            const checkboxes = document.querySelectorAll(".checkbox");

            checkboxes.forEach(checkbox => {
            checkbox.addEventListener("click", () => {
                // Toggle the data-checked attribute
                const isChecked = checkbox.getAttribute("data-checked") === "true";
                checkbox.setAttribute("data-checked", !isChecked);
            });
            });
        }

        function submit() {
            // Get values from form
            let name = getId("name").value;
            let type = getId("type").value;

            let description_proficient = getId("description-proficient").value;
            let description_expert = getId("description-expert").value;
            let description_master = getId("description-master").value;
            let description_grandmaster = getId("description-grandmaster").value;
            
            toBackend("database.set_proficiency("+
                "`"+name+"`,"+
                "`"+type+"`,"+
                "`"+description_proficient+"`,"+
                "`"+description_expert+"`,"+
                "`"+description_master+"`,"+
                "`"+description_grandmaster+"`"+
            ")")
        }



        //=====================================================================================================
        // Execution
        //=====================================================================================================

        function loadPage() {

            getId("content").innerHTML += 

                container("Basic",
                    input("name", "Name", "Proficiency name") +

                    select("type", "Type", [
                        "skill", "combat", "save", "tool"], "Proficiency type")
                ) +

                container("Information",
                    text_area("description-proficient", "Proficiency", "5") +

                    text_area("description-expert", "Expertise", "5") +

                    text_area("description-master", "Mastery", "5") +

                    text_area("description-grandmaster", "Grandmastery", "5")
                )
        }

        function onWindowLoad() {
            loadPage()

            let close_button = getId("close")
            let submit_button = getId("submit")

            close_button.addEventListener("click", () => { closePage("Spell") })
            submit_button.addEventListener("click", () => { submit() })

            loadCheckboxes()
            updateFields()
        }

        document.addEventListener("DOMContentLoaded", onWindowLoad)

        //=====================================================================================================

    </script>
    ']
</head>

<input type="text" class="hidden" id="id" value="{id}"></input>

<body>
    <div class="outer">

        <div id="content"></div>

        <button id="close">Close</button>
        <button id="submit">Save</button>

    </div>
</body>

}]