[dialog5("Database",  "width=800; height=800; temporary=1; input=1; noframe=0"), code: {
<head>
[r:style()]
[r:script()]
[r:'
<style>
    img {
        image-rendering: smooth;
        margin: 0px;
    }

    img:hover {
        opacity: 0.5;
    }

    img:active {
        opacity: 0.3;
    }

    .action-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    .action-button {
        font-size: 75%;
        min-height: 0px;
        min-width: 0px;
        padding: 3px 3px;
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .action-button:hover {
        background-color: #0056b3;
    }

    .table-container {
        margin: 10px;
    }

    .table-header {
        display: grid;
        grid-template-columns: min-content 1fr 1fr 100px; /* Adjusts columns for minimal space */
        gap: 10px;
        color: white;
        padding: 0px 10px;
        border-radius: 10px;
        font-weight: bold;
        align-items: center;
        text-align: left;
    }

    .table-row {
        position:relative;
        transition: background-color 0.3s;

        display: grid;
        grid-template-columns: min-content 1fr 1fr 100px; /* Adjusts columns for minimal space */
        gap: 10px;
        padding: 2px 10px;
        padding-top: 7px;
        margin: 10px 0px;

        background-color: #444;
        border-radius: 5px;

        align-items: center;
        text-align: left;
        font-weight: bold;
        z-index: 3;
    }

    .table-row:hover {
        background-color: #555;
    }

    .collapsible-content {
        position:relative;
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s ease, transform 0.3s ease, visibility 0s linear 0.3s; /* Smooth transition */
        display: none;

        position: relative;
        height: 0px;
        top: -20px;
        z-index: 0;

        margin: 0px 3px;
        padding: 10px;
        padding-top: 15px;

        background-color: #333;
        border: 1px solid #444;
        border-radius: 5px;
        border-top-left-radius: 0px;
        border-top-right-radius: 0px;
    }

    .table-row.open + .collapsible-content {
        display:block;
        height: fit-content;
        margin-bottom: -20px;
        opacity: 1; /* Fully visible */
        visibility: visible; /* Make it interactable */
        transform: translateY(0); /* Final position */
        transition: opacity 0.3s ease, transform 0.3s ease, visibility 0s linear 0s; /* Transition without delay for showing */
    }

    .outer {
        margin-top: 20px;
    }

    .tab-switch-div {
        display: flex;                     /* Use flexbox for layout */
        justify-content: space-between;    /* Distribute tabs with space between them */
        align-items: center;               /* Vertically center the tabs */
        position: relative;
        margin-bottom: -2px;
        height: 30px;                      /* Min height */
    }

    .tab-switch {
        z-index: 0;
        min-height: 20px;
        padding: 3px;                 /* Adjust padding */
        text-align: center;
        background-color: #292929;
        color: #ddd;
        border: 2px solid #414141;
        border-radius: 7px;
        font-size: 75%;
        cursor: pointer;
        transition: background-color 0.3s;
    }

    .tab-switch:hover {
        background-color: #444;
    }

    .tab-switch.active {
        background-color: #414141;
    }

    .tab-switch-div .tab-switch {
        flex: 1;                           /* Make each tab take equal space */
        margin: 0 5px;                     /* Add spacing between tabs */
        text-align: center;                /* Ensure text is centered */
    }

    .tab-switch-div .tab-switch:first-child {
        margin-left: 15px;                    /* Remove left margin for the first tab */
    }

    .tab-switch-div .tab-switch:last-child {
        margin-right: 15px;                   /* Remove right margin for the last tab */
    }
</style>
<script>

    //=====================================================================================================
    // Execution
    //=====================================================================================================

    function onWindowLoad() {
        addTabFunctionality()

        // Start tabs
        damageTab()
        featuresTab()
        setInterval(
            ()=>{
                damageTab()
                featuresTab()
            }
        , 200)
    }


    //=====================================================================================================
    // Helper functions
    //=====================================================================================================

    function hash(string) {
        
        let hash = 0;

        if (string.length == 0) return hash;

        for (i = 0; i < string.length; i++) {
            char = string.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }

        return hash;
    }

    function addTabFunctionality() {
        let tab_list  = ["classes","races","proficiencies","conditions", "features", "items", "damage", "resources", "spells"]

        tab_list.forEach((tab_name) => {
            getId(tab_name+"-switch").addEventListener("click", () => {
                tab_list.forEach((value) => {
                    let button = getId(value+"-switch")
                    let div = getId(value+"-tab")
                    if (tab_name == value) {
                        button.setAttribute("class", "tab-switch active")
                        div.setAttribute("style", "")
                    } else {
                        button.setAttribute("class", "tab-switch")
                        div.setAttribute("style", "display:none")
                    }
                })
            })
        })
        
    }

    function updateColapsible() {
        document.querySelectorAll(".table-row").forEach(row => {
            row.addEventListener("click", () => {
                const isOpen = row.classList.contains("open");
                document.querySelectorAll(".table-row").forEach(r => r.classList.remove("open"));

                if (!isOpen) {
                    row.classList.add("open");
                }
            });
        });

        document.querySelectorAll(".action-buttons img").forEach(button => {
            button.addEventListener("click", event => {
                event.stopPropagation(); // Prevent triggering row click
            });
    });
    }

    function filterObjectByString(obj, searchString) {
        const lowerCaseSearch = searchString.toLowerCase();

        function filter(obj) {
            return Object.fromEntries(
                Object.entries(obj).filter(([key, value]) => {
                    const keyMatches = key.toLowerCase().includes(lowerCaseSearch);
                    const valueMatches =
                        typeof value === "string" &&
                        value.toLowerCase().includes(lowerCaseSearch);

                    if (typeof value === "object" && value !== null && !Array.isArray(value)) {
                        const nestedResult = filter(value); // Recursively filter nested objects
                        return keyMatches || Object.keys(nestedResult).length > 0;
                    }

                    return keyMatches || valueMatches;
                }).map(([key, value]) => {
                    if (typeof value === "object" && value !== null && !Array.isArray(value)) {
                        return [key, filter(value)]; // Recursively filter nested objects
                    }
                    return [key, value];
                })
            );
        }

        return filter(obj);
    }

    //=====================================================================================================
    // Sync management
    //=====================================================================================================

    function damageTab() {

        function row(name, type, description, image) {

            return `
            <div class="table-row" style="grid-template-columns: 30px 1fr 1fr 100px;">
                <div><img src=`+image+`-24 style="opacity:1"></div>
                <div>`+capitalize(name)+`</div>
                <div>`+capitalize(type)+`</div>
                <div class="action-buttons">
                    <img id="`+name+`-edit-damage" src=asset://1ceaeb30a0df8232adc84209a54e5829-24>
                    <img id="`+name+`-remove-damage" src=asset://eaf41cb4f2d8b12ccf85c865b4a2c32f-24>
                </div>
            </div>
            <div class="collapsible-content">
                <pre style="white-space: pre-wrap; word-wrap: break-word; font-family:inherit; text-align:left">`+description+`</pre>
            </div>
        `
        }

        function table(rows, hash) {
            return `
            <div class="table-container" id="damage-table" hash="`+hash+`">
                <div class="table-header" style="grid-template-columns: 30px 1fr 1fr 100px;">
                    <div></div>
                    <div>Name</div>
                    <div>Type</div>
                    <div style="text-align:right;">Actions</div>
                </div>

                `+rows+`

            </div>
            `
        }

        function button_add_new() {
            return `
            <button id="new-damage-type" style="
                position: sticky;
                bottom:0px;
                z-index: 20;
                background-color: #292929;
                color: #ddd;
                border: 2px solid #ddd;
                font-size:100%;
                transform: translate(42vw);

            ">
                Create New
            </button>
            `
        }

        let rows = "" // Stores HTML for all of the rows
        let items = [] // Stores the name of each value added to the table

        // Get data from backend
        toBackend("database.damage_types", (response) => { response = JSON.parse(response)
            
            let filtered_response = response.data
            
            filtered_response = filterObjectByString(filtered_response, getId("damage-search-bar").value)

            // Verifies if new JSON is equal to current iteration of table
            let new_hash = hash(JSON.stringify(filtered_response))
            let previous_hash = getId("damage-table") != undefined ? getId("damage-table").getAttribute("hash") : undefined;
            if (new_hash == previous_hash) { return }

            for (const key in filtered_response) {
                damage = response.data[key]
                
                items.push(damage.name) // Add to list of items
                rows += row(damage.name, damage.type, damage.description, damage.image) // Create new row

            }

            getId("damage-tab-content").innerHTML = table(rows, new_hash) + button_add_new() // Create whole tab
            getId("new-damage-type").addEventListener("click", ()=>{ openPage("damage_set.html","") })

            updateColapsible()

            for (const value of items) {

                // Edit buttons behavior
                getId(value+"-edit-damage").addEventListener("click", ()=>{
                    openPage("damage_set.html", value)
                })

                // Remove buttons behavior
                getId(value+"-remove-damage").addEventListener("click", ()=>{
                    toBackend(`database.remove_damage_type("`+value+`")`)
                })
            }
        })
    }

    function featuresTab() {

        function row(name, type, level, description) {
            image = ""

            return `
            <div class="table-row" style="grid-template-columns: 30px 1fr 1fr 1fr 100px;">
                <div><img src=`+image+`-24 style="opacity:1"></div>
                <div>`+capitalize(name)+`</div>
                <div>`+capitalize(type)+`</div>
                <div>`+level+`</div>
                <div class="action-buttons">
                    <img id="`+name+`-edit-feature" src=asset://1ceaeb30a0df8232adc84209a54e5829-24>
                    <img id="`+name+`-remove-feature" src=asset://eaf41cb4f2d8b12ccf85c865b4a2c32f-24>
                </div>
            </div>
            <div class="collapsible-content">
                <pre style="white-space: pre-wrap; word-wrap: break-word; font-family:inherit; text-align:left">`+description+`</pre>
            </div>
        `
        }

        function table(rows, hash) {
            return `
            <div class="table-container" id="features-table" hash="`+hash+`">
                <div class="table-header" style="grid-template-columns: 30px 1fr 1fr 1fr 100px;">
                    <div></div>
                    <div>Name</div>
                    <div>Type</div>
                    <div>Level</div>
                    <div style="text-align:right;">Actions</div>
                </div>

                `+rows+`

            </div>
            `
        }

        function button_add_new() {
            return `
            <button id="new-feature" style="
                position: sticky;
                bottom:0px;
                z-index: 20;
                background-color: #292929;
                color: #ddd;
                border: 2px solid #ddd;
                font-size:100%;
                transform: translate(42vw);
            ">
                Create New
            </button>
            `
        }

        let rows = "" // Stores HTML for all of the rows
        let items = [] // Stores the name of each value added to the table

        // Get data from backend
        toBackend("database.features", (response) => { response = JSON.parse(response)
            
            let filtered_response = response.data
            
            filtered_response = filterObjectByString(filtered_response, getId("features-search-bar").value)


            // Verifies if new JSON is equal to current iteration of table
            let new_hash = hash(JSON.stringify(filtered_response))
            let previous_hash = getId("features-table") != undefined ? getId("features-table").getAttribute("hash") : undefined;
            if (new_hash == previous_hash) { return }

            for (const key in filtered_response) {
                let feature = response.data[key]

                let type = feature.subtype == "" ? feature.type : feature.subtype
                
                items.push(feature.name) // Add to list of items
                rows += row(feature.name, type, feature.level, feature.description) // Create new row

            }

            getId("features-tab-content").innerHTML = table(rows, new_hash) + button_add_new() // Create whole tab
            getId("new-feature").addEventListener("click", ()=>{ openPage("feature_set.html","") })

            updateColapsible()

            for (const value of items) {

                // Edit buttons behavior
                getId(value+"-edit-feature").addEventListener("click", ()=>{
                    openPage("feature_set.html", value)
                })

                // Remove buttons behavior
                getId(value+"-remove-feature").addEventListener("click", ()=>{
                    toBackend(`database.remove_feature("`+value+`")`)
                })
            }
        })
    }

    //=====================================================================================================

    document.addEventListener("DOMContentLoaded", onWindowLoad)
</script>
']
</head>

<body>

    <div class="tab-switch-div">
        <button class="tab-switch" id="classes-switch">Classes</button>
        <button class="tab-switch" id="races-switch">Races</button>
        <button class="tab-switch" id="proficiencies-switch">Proficiencies</button>
        <button class="tab-switch" id="conditions-switch">Conditions</button>
        <button class="tab-switch" id="features-switch">Features</button>
        <button class="tab-switch" id="items-switch">Items</button>
        <button class="tab-switch active" id="damage-switch">Damage</button>
        <button class="tab-switch" id="resources-switch">Resources</button>
        <button class="tab-switch" id="spells-switch">Spells</button>
    </div>

    <div class="outer" id="classes-tab" style="display:none">
    </div>

    <div class="outer" id="races-tab" style="display:none">
    </div>

    <div class="outer" id="proficiencies-tab" style="display:none">
    </div>

    <div class="outer" id="conditions-tab" style="display:none">
    </div>

    <div class="outer" id="features-tab" style="display:none">
        <input id="features-search-bar" value="" placeholder="Search..." style="width:50%;"></input>
        <div id="features-tab-content">
        </div>
    </div>

    <div class="outer" id="items-tab" style="display:none">
    </div>

    <div class="outer" id="damage-tab">
        <input id="damage-search-bar" value="" placeholder="Search..." style="width:50%;"></input>
        <div id="damage-tab-content">
        </div>
    </div>

    <div class="outer" id="resources-tab" style="display:none">
    </div>

    <div class="outer" id="spells-tab" style="display:none">
    </div>

</body>

}]