[dialog5("Character Creation", "width=450; height=800; temporary=1; input=1; noframe=0"), code: {

[r:'
<style>

body {
    background: #333;
    color: #ddd;
    font-size: 11px;
}



form {
    width:80%;
    max-width: 375px;
    position:relative;
    left:50%;
    transform: translate(-50%);
}

form input, form select{
    -webkit-appearance: none;
    width: 90%;
    left:50%;
    position:relative;
    transform: translate(-50%);

    background-color: white;
    border: none;
    border-radius: 5px;

    padding:5px;
    margin-bottom: 20px;
}
form input:focus, form select:focus{
    outline: none;
}

form .header {
    text-align:center;
    text-indent: 0px;
    font-size: 110%;
    font-weight: 700;
    margin-top: 40px;
    display:none;
}

form p {
    text-indent:5%;
    margin-bottom: 3px;
}

button:hover {
    cursor:pointer;
}



.section {

    padding: 10px;
    padding-top: 5px;
    padding-bottom: 10px;
    
    margin-top: 20px;
    margin-bottom: 20px;

    border: 0.1px solid #aaa;
    border-radius: 5px;
}

.center {
    text-align:center;
    text-indent: 0;
}

.points {
    margin-top: 4px;
    font-size: 120%;
    font-weight: bold;
}

.hidden {
    display:none
}




#submit {
    position: absolute;
    bottom: 5%;
    left: 50%;
    transform: translate(-50%);
}



.grid-container {
    position:relative;
    padding-top: 12px;
    padding-right: 5px;
    padding-left:5px;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(2, auto);
    gap: 10px;
}

.grid-item {
    background-color: #333;
    border: 1px solid #555;
    border-radius: 5px;
    padding: 20px;
    height: 70px;
    text-align: center;
    padding-left: 10px;
    padding-right: 10px;
    position:relative;
}
.attribute-name {
    position:absolute;
    text-align: center;
    font-size: 110%;
    top: 5px;
    left:50%;
    transform: translate(-50%);
}
.attribute-score {
    position:absolute;
    top:47%;
    left:50%;
    transform: translate(-50%, -50%);
    font-size: 250%;
    font-weight: bold;
}
.attribute-button {
    margin:0px;
    width: 20px;
    height: 20px;
    text-align: center;
    padding: 0px;
    font-weight: bold;
}
.bottom{
    position: absolute;
    bottom: 2px;
    left: 50%;
    transform: translate(-50%);
}
</style>
<script>

    //=====================================================================================================
    // Execution
    //=====================================================================================================

    function onWindowLoad() {

        let id = getId("id")

        loadCurrentFieldValue("name", "creature.name")
        loadCurrentFieldValue("type", "creature.type")
        loadCurrentFieldValue("race", "creature.race")

        getId("submit").addEventListener("click", async () => {

            // Get values from form
            let name = getId("name");
            let type = getId("type");
            let race = getId("race");

            // Get attribute values from form
            let str = getId("str");
            let dex = getId("dex");
            let con = getId("con");
            let wis = getId("wis");
            let int = getId("int");
            let cha = getId("cha");

            // Check if form is valid
            let valid = true
            if (name.value == "") {valid = false}
            if (type.value == "") {valid = false}
            if (race.value == "" && type.value == "Humanoid") {valid = false}
            if (valid == false) {return}

            let race_value = race.value
            if(race_value == "") {race_value = type.value}

            // Send data to backend
            toBackend(
                "var creature = new Creature(`"+id.value+"`, true);"+
                "creature.create("+
                    "`"+name.value+"`,"+
                    "`"+type.value+"`,"+
                    "`"+race_value+"`,"+
                    "`"+str.innerHTML+"`,"+
                    "`"+dex.innerHTML+"`,"+
                    "`"+con.innerHTML+"`,"+
                    "`"+wis.innerHTML+"`,"+
                    "`"+int.innerHTML+"`,"+
                    "`"+cha.innerHTML+"`,"+
                ")"
            )

            // Close page
            closeDialog("Character Creation")

        })

        getId("type").addEventListener("input", () => {
            updateRaceVisibility()
        })
    }



    //=====================================================================================================
    // Helper functions
    //=====================================================================================================

    function getId(id) {return document.getElementById(id)}

    function updateRaceVisibility() {
        let type = getId("type")
        let race = getId("race-div")

        if (type.value == "Humanoid") {
            race.setAttribute("style", "display: block")}
        else {
            race.setAttribute("style", "display: none")}
    }

    function loadCurrentFieldValue(fieldId, request) {
        let id = getId("id")

        toBackend("var creature = new Creature(`"+id.value+"`);"+request,
            (response) => {
                getId(fieldId).value = response
                updateRaceVisibility()
            })
    }



    //=====================================================================================================
    // External functions
    //=====================================================================================================

    function toBackend(arguments, valueCallback) {
        let request = new XMLHttpRequest();
        request.open("POST", "macro:console@lib:main", true);

        request.onreadystatechange = function() {
            if (request.readyState == 4) {
                valueCallback(request.response);
            }
        };
        request.send(arguments);
    }

    function closeDialog(arguments) {
        let request = new XMLHttpRequest();
        request.open("POST", "macro:closeDialog@lib:main", true);

        request.onreadystatechange = function() {
            if (request.readyState == 4) {
                valueCallback(request.response);
            }
        };
        request.send(arguments);
    }
    


    //=====================================================================================================

    document.addEventListener("DOMContentLoaded", onWindowLoad)

</script>
']



<form>
    <div class="section" id="basic-character-info">

        <div id="name-div">
            <input type="text" class="hidden" id="id" value="{getSelected()}"></input>
            <p>Name:</p>
            <input type="text" id="name" placeholder></input>
        </div>

        <div id="type-div">
            <p>Type:</p>
            <select id="type">
                <option value="" hidden>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                </option>
                <option>Aberration</option>
                <option>Beast</option>
                <option>Celestial</option>
                <option>Construct</option>
                <option>Dragon</option>
                <option>Elemental</option>
                <option>Fey</option>
                <option>Fiend</option>
                <option>Giant</option>
                <option>Humanoid</option>
                <option>Monstrosity</option>
                <option>Ooze</option>
                <option>Plant</option>
                <option>Undead</option>
            </select>
        </div>

        <div id="race-div" style="display:none">
            <p>Race:</p>
            <select id="race">
                <option value="" hidden>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                </option>
                <option>Hill Dwarf</option>
                <option>Mountain Dwarf</option>
                <option>High Elf</option>
                <option>Wood Elf</option>
                <option>Drow</option>
                <option>Lightfoot Halfling</option>
                <option>Stout Halfling</option>
                <option>Half-Orc</option>
                <option>Human</option>
                <option>Half-Elf</option>
                <option>Rock Gnome</option>
                <option>Forest Gnome</option>
            </select>
        </div>

    </div>
    <div class="section" id="attributes">

        <p class="center">Total Points:</p>
        <p class="center points"><span id="total-points">12</span> / 27</p>
        <div class="grid-container">

            <div class="grid-item">
                <div class="attribute-name">
                    Strength
                </div>
                <span id ="str" class="attribute-score">10</span>
                <div class="bottom">
                    <button class="attribute-button">-</button>
                    <button class="attribute-button">+</button>
                </div>
            </div>

            <div class="grid-item">
                <div class="attribute-name">
                    Dexterity
                </div>
                <span id ="dex" class="attribute-score">10</span>
                <div class="bottom">
                    <button class="attribute-button">-</button>
                    <button class="attribute-button">+</button>
                </div>
            </div>

            <div class="grid-item">
                <div class="attribute-name">
                    Constitution
                </div>
                <span id ="con" class="attribute-score">10</span>
                <div class="bottom">
                    <button class="attribute-button">-</button>
                    <button class="attribute-button">+</button>
                </div>
            </div>

            <div class="grid-item">
                <div class="attribute-name">
                    Wisdom
                </div>
                <span id ="wis" class="attribute-score">10</span>
                <div class="bottom">
                    <button class="attribute-button">-</button>
                    <button class="attribute-button">+</button>
                </div>
            </div>

            <div class="grid-item">
                <div class="attribute-name">
                    Intelligence
                </div>
                <span id ="int" class="attribute-score">10</span>
                <div class="bottom">
                    <button class="attribute-button">-</button>
                    <button class="attribute-button">+</button>
                </div>
            </div>

            <div class="grid-item">
                <div class="attribute-name">
                    Charisma
                </div>
                <span id ="cha" class="attribute-score">10</span>
                <div class="bottom">
                    <button class="attribute-button">-</button>
                    <button class="attribute-button">+</button>
                </div>
            </div>

        </div>
    </div>
</form>

<button id="submit">Accept</button>

}]